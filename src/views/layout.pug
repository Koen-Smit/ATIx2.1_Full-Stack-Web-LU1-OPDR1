doctype html
html
  head
    meta(charset="UTF-8")
    meta(name="viewport", content="width=device-width, initial-scale=1.0")
    title= title
    link(rel='stylesheet', href='/stylesheets/style.css')
    link(rel="stylesheet", href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css")
    link(rel="stylesheet", href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.11.3/font/bootstrap-icons.min.css")
  body.m-0.p-0
    nav.navbar.navbar-expand-lg.navbar-dark.bg-dark.shadow-sm
      .container-fluid
        a.navbar-brand.fw-bold(href="/")
          i.bi.bi-building.me-2
          | Sakila Film verhuur
        
        button.navbar-toggler(type="button" data-bs-toggle="collapse" data-bs-target="#navbarNav" aria-controls="navbarNav" aria-expanded="false" aria-label="Toggle navigation")
          span.navbar-toggler-icon
        
        .collapse.navbar-collapse#navbarNav
          ul.navbar-nav.me-auto
            if user
              li.nav-item
                a.nav-link(href="/customers" class=title === 'Klanten Beheer' ? 'active' : '')
                  i.bi.bi-people.me-1
                  | Klanten
              li.nav-item
                a.nav-link(href="/films" class=title === 'Films Beheer' ? 'active' : '')
                  i.bi.bi-film.me-1
                  | Films
              li.nav-item
                a.nav-link(href="/about" class=title === 'Over dit Project' ? 'active' : '')
                  i.bi.bi-info-circle.me-1
                  | About
          
          ul.navbar-nav
            if user
              li.nav-item.dropdown
                a.nav-link.dropdown-toggle(href="#" role="button" data-bs-toggle="dropdown" aria-expanded="false")
                  i.bi.bi-person-circle.me-1
                  | #{user.name || 'User'}
                ul.dropdown-menu.dropdown-menu-end
                  li
                    a.dropdown-item(href="/auth/profile")
                      i.bi.bi-person.me-2
                      | Profiel
                  li
                    hr.dropdown-divider
                  li
                    form.form-inline-display(action="/auth/logout" method="POST")
                      button.dropdown-item.text-danger(type="submit")
                        i.bi.bi-box-arrow-right.me-2
                        | Uitloggen
            else
              li.nav-item
                a.btn.btn-outline-light.btn-sm(href="/auth/login")
                  i.bi.bi-box-arrow-in-right.me-1
                  | Inloggen

    .toast-container.position-fixed.top-0.start-50.translate-middle-x.mt-3.toast-container-top
      if errorMessage
        .toast.show.align-items-center.text-bg-danger.border-0(role="alert" aria-live="assertive" aria-atomic="true" data-bs-autohide="true" data-bs-delay="5000")
          .d-flex
            .toast-body #{errorMessage}
            button.btn-close.btn-close-white.me-2.m-auto(type="button" data-bs-dismiss="toast" aria-label="Close")

    block content

    script(src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js")
    
    script.
      document.addEventListener('DOMContentLoaded', function() {
        const urlParams = new URLSearchParams(window.location.search);
        const errorParam = urlParams.get('error');
        const successParam = urlParams.get('success');
        
        if (errorParam) {
          showToast(decodeURIComponent(errorParam), 'danger');
          urlParams.delete('error');
        }
        
        if (successParam) {
          showToast(decodeURIComponent(successParam), 'success');
          urlParams.delete('success');
        }
        
        if (errorParam || successParam) {
          const newUrl = window.location.pathname + (urlParams.toString() ? '?' + urlParams.toString() : '');
          window.history.replaceState({}, document.title, newUrl);
        }

        var tooltipTriggerList = [].slice.call(document.querySelectorAll('[data-bs-toggle="tooltip"]'));
        var tooltipList = tooltipTriggerList.map(function (tooltipTriggerEl) {
          return new bootstrap.Tooltip(tooltipTriggerEl);
        });
      });

      function showToast(message, type = 'danger') {
        const toastContainer = document.querySelector('.toast-container');
        
        const toastElement = document.createElement('div');
        toastElement.className = `toast align-items-center text-bg-${type} border-0`;
        toastElement.setAttribute('role', 'alert');
        toastElement.setAttribute('aria-live', 'assertive');
        toastElement.setAttribute('aria-atomic', 'true');
        toastElement.setAttribute('data-bs-autohide', 'true');
        toastElement.setAttribute('data-bs-delay', '5000');
        
        toastElement.innerHTML = `
          <div class="d-flex">
            <div class="toast-body">${message}</div>
            <button type="button" class="btn-close btn-close-white me-2 m-auto" data-bs-dismiss="toast" aria-label="Close"></button>
          </div>
        `;
        
        toastContainer.appendChild(toastElement);
        
        const toast = new bootstrap.Toast(toastElement);
        toast.show();
        
        toastElement.addEventListener('hidden.bs.toast', function() {
          toastElement.remove();
        });
      }

      window.showToast = showToast;
